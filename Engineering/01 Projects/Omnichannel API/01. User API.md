

**Status:** In Progress  
**Thumbnail:** `#6A9BFF`  
**Description:** User onboarding, identity, compliance & profile management  
**Application:** Retail Engine  
**Due On:** 2025-10-20T12:00:00

---

## Overview

The **Users API Module** manages the entire lifecycle of a platform userâ€”from identity creation, verification, compliance processing, banking account creation, and user profile personalization. It serves as the core onboarding engine that powers digital access for individuals across ADIBA-powered institutions.

This module orchestrates identity validation, account provisioning, CRM enrichment, messaging notifications, and user settings initialization.

---

## Core Business Functions

- **User Onboarding** â€“ identity creation, verification, and welcome flows  
- **Identity Verification** â€“ BVN/NIN lookup and verification code workflows  
- **Document Compliance Processing** â€“ upload and validation of compliance and identification documents  
- **User Profile Management** â€“ update of identity attributes and CRM/Bank sync  
- **Message Retrieval** â€“ user system notifications & messages  
- **User Preferences & Settings** â€“ personalization, environment settings  

---

## Technical Dependencies

| Component | Business Purpose |
|----------|------------------|
| **Identity Processor** | Validation, verification sessions, code handling |
| **Identity Adapter** | Primary identity creation & claims updates |
| **Core Banking Adapter (CBA)** | Creates banking accounts & retrieves banking data |
| **Payments Processor** | Handles payment method initialization |
| **CRM Adapter** | Updates CRM contact and account linkage |
| **Messages Worker** | Sends onboarding, OTP, and verification notifications |
| **Documents Processor** | Stores & processes compliance and identity documents |
| **User Settings Utility** | Configures user preferences & environment |

---

# REST Endpoints

## 1. User Onboarding APIs

| API | Tag | Name | Summary | Description | Verb | Route |
|-----|------|---------|-----------|--------------|--------|--------|
| Users API | User Onboarding | Onboard New User | Create User Identity | Creates user identity with basic profile and initiates verification | POST | `/users/profile` |
| Users API | User Onboarding | Lookup Existing User | Lookup User Identity | Retrieves user identity using account number | GET | `/users/profile/by/{accountNo}` |
| Users API | User Onboarding | Onboard Existing User | Complete Banking Account Creation | Creates banking account in CBA for verified users | POST | `/users/profile/by/{accountNo}` |
| Users API | User Onboarding | Trigger Identity Verification | Verify Identity Documents | Starts BVN/NIN verification session | POST | `/users/identity/lookup` |
| Users API | User Onboarding | Resend Verification Code | Resend Verification Code | Sends a new identity verification code | POST | `/users/identity/resend-code` |
| Users API | User Onboarding | Confirm Identity Verification | Confirm Identity Verification | Validates verification code and marks identity as verified | POST | `/users/identity/confirm` |
| Users API | User Compliance | Upload Compliance Document | Upload Compliance Documents | Uploads regulatory compliance files | POST | `/users/documents/compliance` |
| Users API | User Onboarding | Upload Identity Document | Upload Identity Documents | Uploads government-issued ID for KYC | POST | `/users/documents/identification` |
| Users API | User Onboarding | Upload Profile Picture | Upload Profile Picture | Uploads user avatar | POST | `/users/profile/avatar` |
| Users API | User Onboarding | Trigger Email Verification | Trigger Email Verification | Sends verification email | POST | `/users/email/verify` |

---

## 2. User Profile APIs

| API | Tag | Name | Summary | Description | Verb | Route |
|-----|------|----------|-----------|--------------|--------|--------|
| Users API | User Profile | View User Profile | View User Profile | Retrieves complete user profile | GET | `/users/profile/my` |
| Users API | User Profile | View User Avatar | View User Avatar | Retrieves profile picture with access control | GET | `/users/profile/avatar` |
| Users API | User Profile | Update User Attributes | Update User Attributes | Partial updates to profile information | PUT | `/users/claims/my` |

---

## 3. User Messages API

| API | Tag | Name | Summary | Description | Verb | Route |
|-----|------|----------|-----------|--------------|--------|--------|
| Users API | User Messages | List User Messages | List User Messages | Retrieves system notifications for user | GET | `/users/messages` |

---

# Component Interactions (Pipeline Responsibilities)

## Onboarding & Verification Workflows

| Route | Identity Processor | Identity Adapter | CBA Adapter | Payments Processor | CRM Adapter | Messages Worker | Documents Processor | User Settings Utility |
|--------|------------------------|-------------------|--------------|----------------------|----------------|------------------------|---------------------------|----------------------------|
| **POST /users/profile** | 5. Validate Input & Initiate Identity Record | 6. Create User in Identity System | 7. Create Client Record | - | 8. Create Partner Record | 9. Send Welcome & Verification Instructions | - | 8. Set Basic User Preferences |
| **GET /users/profile/by/{accountNo}** | 5. Validate Access Rights | 6. Fetch Identity Data | - | - | - | - | - | - |
| **POST /users/profile/by/{accountNo}** | 5. Verify Identity Status & Compliance | - | 6. Create Banking Account in CBA | 7. Initialize Payment Methods | 8. Update CRM with Account Details | 9. Send Account Ready Notification | - | 10. Set Banking Preferences |
| **POST /users/identity/lookup** | 5. Call BVN/NIN Verification Service | 6. Store Verification Session | - | - | - | 7. Send OTP/Verification Code | - | - |
| **POST /users/identity/resend-code** | 5. Generate New Verification Code | 6. Update Session with New Code | - | - | - | 7. Resend SMS/Email with Code | - | - |
| **POST /users/identity/confirm** | 5. Validate Code & Update Verification Status | 6. Mark Identity as Verified | - | - | - | 7. Send Verification Success Message | - | - |
| **POST /users/documents/compliance** | 5. Validate Document Requirements | - | - | - | - | - | 6. Process & Store Compliance Documents | 7. Update Compliance Status |
| **POST /users/documents/identification** | 5. Validate ID Document | - | - | - | - | - | 6. Process & Store ID Document | 7. Update KYC Document Status |
| **POST /users/profile/avatar** | 5. Validate Image Format | - | - | - | - | - | 6. Process & Optimize Image | 7. Update Avatar Reference |
| **POST /users/email/verify** | 5. Generate Email Verification Token | - | - | - | - | 6. Send Verification Email | - | - |
| **GET /users/profile/my** | 5. Authenticate & Get User Claims | 6. Fetch Identity Profile | 7. Fetch CBA Account Status | - | 8. Enrich with CRM Data | - | - | 9. Apply User Settings |
| **GET /users/profile/avatar** | 5. Validate Access Rights | - | - | - | - | - | 6. Serve Image File | - |
| **PUT /users/claims/my** | 5. Validate Update Permissions | 6. Update Identity Claims | 7. Sync with CBA if Needed | - | 8. Update CRM Record | - | - | 9. Update User Preferences |
| **GET /users/messages** | 5. Authenticate User Session | - | - | - | - | 6. Fetch User Messages | - | 7. Apply Message Settings |

---

# Security & Governance

## Permissions & APIs

| Permission | Name | APIs | Status |
|------------|----------|--------|--------|
| **usr_onboard** | Onboard Users | `/users/profile`, `/users/identity/*` | ðŸ”„ |
| **usr_read** | View User Profile | `/users/profile/my`, `/users/profile/by/*` | ðŸ”„ |
| **usr_update** | Update User Attributes | `/users/claims/my` | ðŸ”„ |
| **usr_docs** | Upload User Docs | `/users/documents/*` | ðŸ”„ |
| **usr_messages** | Read User Messages | `/users/messages` | ðŸ”„ |

---

## Roles & Permissions

| Role | Name | Permissions | Status |
|-------|---------|----------------|--------|
| **UR001** | Administrator | usr_onboard, usr_update, usr_docs, usr_messages | ðŸ”„ |
| **UR002** | Onboarding Officer | usr_onboard, usr_docs | ðŸ”„ |
| **UR003** | Customer Service | usr_read, usr_messages | ðŸ”„ |
| **UR004** | Compliance Officer | usr_read, usr_docs | ðŸ”„ |

---

## Policies & Attributes

| Policy ID | Policy | Condition | Status |
|-----------|---------|-------------|--------|
| **P_USR_001** | Org MUST have active RE Subscription | `org.apps.retail eq active` | ðŸ”„ |
| **P_USR_002** | Users can ONLY update their own profile | `subject.id eq user.id` | ðŸ”„ |

---

## Related Documents

- **Identity Verification Framework â€“ ADIBA Standard**
- **Customer Lifecycle & Compliance Model**
- **Messaging Templates â€“ User Onboarding**

---

