
**Status:** In Progress  
**Thumbnail:** `#6A9BFF`  
**Description:** User onboarding, identity, compliance & profile management  
**Application:** Retail Engine  
**Due On:** 2025-10-20T12:00:00

---

## Overview

The **Users Module** manages the full lifecycle of a platform userâ€”identity creation, document verification, compliance handling, account creation, messaging, and profile maintenance.

It provides the foundational user identity layer used across all ADIBA-powered financial institutions.

---

## Core Business Functions

- **User Onboarding & Identity Creation**  
- **Identity Verification (BVN/NIN, Codes, Sessions)**  
- **Compliance & ID Document Processing**  
- **User Profile Read & Update**  
- **User Messaging & Notifications**  
- **User Preferences & Environment Settings**

---

## Technical Dependencies

| Component                      | Business Purpose                               |
| ------------------------------ | ---------------------------------------------- |
| **Identity Processor**         | Validation, verification workflow, sessions    |
| **Identity Adapter**           | Manage identity records and claims             |
| **Core Banking Adapter (CBA)** | Create bank accounts, retrieve account data    |
| **Payments Processor**         | Initialize payment instruments                 |
| **CRM Adapter**                | Sync CRM contact details                       |
| **Messages Worker**            | Sends notifications, OTPs, verification emails |
| **Documents Processor**        | Processes and stores user documents            |
| **User Settings Utility**      | Manages user preferences and settings          |

---
## ğŸŒ REST Endpoints

| **Code** | **Summary** | **Route** | **Method** | **External ID** | **Status** |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **US001** | Onboard New User | /users/profile | POST | createUserIdentity | ğŸ”„ |
| **US002** | Lookup Existing User | /users/profile/by/{accountNo} | GET | lookupUserIdentity | ğŸ”„ |
| **US003** | Onboard Existing User (Create Bank Account) | /users/profile/by/{accountNo} | POST | completeBankAccountCreation | ğŸ”„ |
| **US004** | Trigger Identity Verification | /users/identity/lookup | POST | verifyIdentityDocuments | ğŸ”„ |
| **US005** | Resend Verification Code | /users/identity/resend-code | POST | resendVerificationCode | ğŸ”„ |
| **US006** | Confirm Identity Verification | /users/identity/confirm | POST | confirmIdentityVerification | ğŸ”„ |
| **US007** | Upload Compliance Document | /users/documents/compliance | POST | uploadComplianceDocument | ğŸ”„ |
| **US008** | Upload Identity Document | /users/documents/identification | POST | uploadIdentityDocument | ğŸ”„ |
| **US009** | Upload Profile Picture | /users/profile/avatar | POST | uploadProfilePicture | ğŸ”„ |
| **US010** | Trigger Email Verification | /users/email/verify | POST | triggerEmailVerification | ğŸ”„ |
| **US011** | View User Profile | /users/profile/my | GET | viewUserProfile | ğŸ”„ |
| **US012** | View User Avatar | /users/profile/avatar | GET | viewUserAvatar | ğŸ”„ |
| **US013** | Update User Attributes | /users/claims/my | PUT | updateUserAttributes | ğŸ”„ |
| **US014** | List User Messages | /users/messages | GET | listUserMessages | ğŸ”„ |
| **US015** | Delete User Message | /users/messages/{message_id} | DELETE | deleteUserMessage | ğŸ”„ |

---

# Component Interactions (Adapter & Worker APIs)

## 1. Identity Processor APIs

| Action    | Summary                                   | Route                             | Method | Operation ID | Status |
| --------- | ----------------------------------------- | --------------------------------- | ------ | ------------ | ------ |
| **IP001** | Validate Input & Create Identity Record   | `/users/profile`                  | POST   | US001        | ğŸ”„     |
| **IP002** | Validate Access Rights                    | `/users/profile/by/{accountNo}`   | GET    | US002        | ğŸ”„     |
| **IP003** | Verify Identity Status & Compliance       | `/users/profile/by/{accountNo}`   | POST   | US003        | ğŸ”„     |
| **IP004** | Start Verification Session (BVN/NIN)      | `/users/identity/lookup`          | POST   | US004        | ğŸ”„     |
| **IP005** | Generate New Verification Code            | `/users/identity/resend-code`     | POST   | US005        | ğŸ”„     |
| **IP006** | Validate Verification Code                | `/users/identity/confirm`         | POST   | US006        | ğŸ”„     |
| **IP007** | Validate Compliance Document Requirements | `/users/documents/compliance`     | POST   | US007        | ğŸ”„     |
| **IP008** | Validate ID Document                      | `/users/documents/identification` | POST   | US008        | ğŸ”„     |
| **IP009** | Validate Image Format                     | `/users/profile/avatar`           | POST   | US009        | ğŸ”„     |
| **IP010** | Generate Email Verification Token         | `/users/email/verify`             | POST   | US010        | ğŸ”„     |
| **IP011** | Authenticate & Retrieve Claims            | `/users/profile/my`               | GET    | US011        | ğŸ”„     |
| **IP012** | Validate Image Access Rights              | `/users/profile/avatar`           | GET    | US012        | ğŸ”„     |
| **IP013** | Validate Update Permissions               | `/users/claims/my`                | PUT    | US013        | ğŸ”„     |
| **IP014** | Authenticate User Session                 | `/users/messages`                 | GET    | US014        | ğŸ”„     |
| **IP015** | Validate Delete Permission                | `/users/messages/{message_id}`    | DELETE | US015        | ğŸ”„     |

---

## 2. Identity Adapter APIs

| Action | Summary | Route | Method | Operation ID | Status |
|--------|----------|--------|---------|----------------|--------|
| **IA001** | Create User in Identity System | `/users/profile` | POST | US001 | ğŸ”„ |
| **IA002** | Fetch Identity Data | `/users/profile/by/{accountNo}` | GET | US002 | ğŸ”„ |
| **IA003** | Mark Identity Verified | `/users/identity/confirm` | POST | US006 | ğŸ”„ |
| **IA004** | Update Identity Claims | `/users/claims/my` | PUT | US013 | ğŸ”„ |
| **IA005** | Fetch Identity Profile | `/users/profile/my` | GET | US011 | ğŸ”„ |

---

## 3. Core Banking Adapter (CBA) APIs

| Action | Summary | Route | Method | Operation ID | Status |
|--------|----------|--------|---------|----------------|--------|
| **CB001** | Create Banking Account | `/users/profile/by/{accountNo}` | POST | US003 | ğŸ”„ |
| **CB002** | Retrieve Bank Account Status | `/users/profile/my` | GET | US011 | ğŸ”„ |
| **CB003** | Sync Profile With CBA | `/users/claims/my` | PUT | US013 | ğŸ”„ |

---

## 4. Payments Processor APIs

| Action | Summary | Route | Method | Operation ID | Status |
|--------|----------|--------|---------|----------------|--------|
| **PP001** | Initialize Payment Methods | `/users/profile/by/{accountNo}` | POST | US003 | ğŸ”„ |

---

## 5. CRM Adapter APIs

| Action | Summary | Route | Method | Operation ID | Status |
|--------|----------|--------|---------|----------------|--------|
| **CR001** | Create Partner Record | `/users/profile` | POST | US001 | ğŸ”„ |
| **CR002** | Update CRM with Account Details | `/users/profile/by/{accountNo}` | POST | US003 | ğŸ”„ |
| **CR003** | Enrich CRM Data | `/users/profile/my` | GET | US011 | ğŸ”„ |
| **CR004** | Update CRM Record | `/users/claims/my` | PUT | US013 | ğŸ”„ |

---

## 6. Messages Worker APIs

| Action | Summary | Route | Method | Operation ID | Status |
|--------|----------|--------|---------|----------------|--------|
| **MW001** | Send Welcome & Verification Instructions | `/users/profile` | POST | US001 | ğŸ”„ |
| **MW002** | Send Verification Code / OTP | `/users/identity/lookup` | POST | US004 | ğŸ”„ |
| **MW003** | Resend Verification Code | `/users/identity/resend-code` | POST | US005 | ğŸ”„ |
| **MW004** | Send Verification Success Message | `/users/identity/confirm` | POST | US006 | ğŸ”„ |
| **MW005** | Send Email Verification | `/users/email/verify` | POST | US010 | ğŸ”„ |
| **MW006** | Fetch User Messages | `/users/messages` | GET | US014 | ğŸ”„ |
| **MW007** | Send Message Deletion Notification | `/users/messages/{message_id}` | DELETE | US015 | ğŸ”„ |

---

## 7. Documents Processor APIs

| Action | Summary | Route | Method | Operation ID | Status |
|--------|----------|--------|---------|----------------|--------|
| **DP001** | Process & Store Compliance Documents | `/users/documents/compliance` | POST | US007 | ğŸ”„ |
| **DP002** | Process & Store ID Documents | `/users/documents/identification` | POST | US008 | ğŸ”„ |
| **DP003** | Process & Optimize Profile Image | `/users/profile/avatar` | POST | US009 | ğŸ”„ |
| **DP004** | Serve Image File | `/users/profile/avatar` | GET | US012 | ğŸ”„ |

---

## 8. User Settings Utility APIs

| Action | Summary | Route | Method | Operation ID | Status |
|--------|----------|--------|---------|----------------|--------|
| **USU001** | Set Basic User Preferences | `/users/profile` | POST | US001 | ğŸ”„ |
| **USU002** | Set Banking Preferences | `/users/profile/by/{accountNo}` | POST | US003 | ğŸ”„ |
| **USU003** | Apply User Settings | `/users/profile/my` | GET | US011 | ğŸ”„ |
| **USU004** | Apply Message Settings | `/users/messages` | GET | US014 | ğŸ”„ |

---

# Security & Governance

## Permissions & APIs

| Permission | Name | APIs | Status |
|------------|-------|--------|--------|
| **usr_onboard** | Onboard Users | US001â€“US010 | ğŸ”„ |
| **usr_read** | View Profiles | US011â€“US012 | ğŸ”„ |
| **usr_update** | Update Profiles | US013 | ğŸ”„ |
| **usr_messages** | Manage Messages | US014â€“US015 | ğŸ”„ |
| **usr_docs** | Upload Documents | US007â€“US009 | ğŸ”„ |

---

## Roles & Permissions

| Role | Name | Permissions | Status |
|-------|---------|----------------|--------|
| **UR001** | Administrator | usr_onboard, usr_update, usr_docs, usr_messages | ğŸ”„ |
| **UR002** | Onboarding Officer | usr_onboard, usr_docs | ğŸ”„ |
| **UR003** | Customer Service | usr_read, usr_messages | ğŸ”„ |
| **UR004** | Compliance Officer | usr_read, usr_docs | ğŸ”„ |

---

## Policies & Attributes

| Policy ID | Policy | Condition | Status |
|-----------|--------|-----------|--------|
| **P_USR_001** | Org MUST have active RE Subscription | `org.apps.retail eq active` | ğŸ”„ |
| **P_USR_002** | Users can ONLY update their own profile | `subject.id eq user.id` | ğŸ”„ |

---

## Related Documents

1. Identity Verification Framework  
2. Customer Lifecycle & Compliance Model  
3. Messaging Templates â€“ User Onboarding
